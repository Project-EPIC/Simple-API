<html>
<head>
<title>Test</title>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">


<!-- JQUERY -->
<script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>

<style>
  body{margin:10; padding:20;}
  h2{margin:20px 0px;}
</style>

</head>
<body>

<h1>Use the code examples offered here to build your API</h1>

<h4>Status Updates here: <span id="status">No updates</span></h4>

<script>

function logID(button){
  var id = button.dataset.id
  var detail = button.dataset.something
  console.log("Clicked button for image: "+id)

  var URL = "http://localhost:4500/write?id="+id+"&other="+detail;

  var xmlHttp = new XMLHttpRequest();
  xmlHttp.open( "GET", URL, true );
  xmlHttp.send( null );

 return xmlHttp.responseText;
}
</script>

<label>User:
  <input id='username' type="textarea" value='Default'></input>
</label>

<h2>Write to stdout with GET request</h2>

<button class="button" data-id="123" data-something="fromtweet1" onClick="logID(this)">BUTTON 1</button>

<h2>POST Request to sqlite</h2>

<button type="button" class="btn btn-light sqlite-button" data-val="0" data-id="1234" data-detail="tweet-for-whatever">SQLITE BUTTON</button>

<button type="button" class="btn btn-light sqlite-button" data-val="0" data-id="5678" data-detail="tweet-for-whatever">SQLITE BUTTON 2</button>

<div style="max-width:500px; margin-top:50px;">
  <button style="margin:10px;" type="button" class="btn btn-light sqlite-button" data-val="0" data-id="9" data-detail="tweet">Test SQLite</button>
  <button style="margin:10px;" type="button" class="btn btn-light sqlite-button" data-val="0" data-id="8" data-detail="tweet">Test SQLite</button>
  <button style="margin:10px;" type="button" class="btn btn-light sqlite-button" data-val="0" data-id="7" data-detail="tweet">Test SQLite</button>
  <button style="margin:10px;" type="button" class="btn btn-light sqlite-button" data-val="0" data-id="6" data-detail="tweet">Test SQLite</button><br>
  <button style="margin:10px;" type="button" class="btn btn-light sqlite-button" data-val="0" data-id="5" data-detail="bilbo">Tweet 5 - Bilbo</button>
  <button style="margin:10px;" type="button" class="btn btn-light sqlite-button" data-val="0" data-id="5" data-detail="frodo">Tweet 5 - Frodo</button>
  <button style="margin:10px;" type="button" class="btn btn-light sqlite-button" data-val="0" data-id="5" data-detail="sam">Tweet 5 - Sam</button>
</div>

<script>

/*
  If your button is classed: "sqlite-button" and has data-val and data-id attributes, then just copy this function!
*/

$(".sqlite-button").click(function(){
  var id     = this.dataset.id
  var detail = this.dataset.detail || ""

  console.log("Clicked button for image: "+id)

  var user   = $('#username').val().toLowerCase() || "no-user-set"
  var val = Number(this.dataset.val)
  var that = this;

  //If val is 0, save the tweet
  if (val==0){
    $.post("http://localhost:4501/sqlite",
    {
        tweet:  id,
        value:  val,
        user:   user,
        detail: detail,
    },
    function(data, status){
      if (status=="success"){
        //Set the data-val to 0
        $(that).attr("data-val","1"); //setter
        that.classList.add('btn-success')
        that.classList.remove("btn-light")
      }
    }).fail(function(xhr, status, error) {
      console.error(xhr, status, error)
      alert("Yikes! Somthing is wrong, likley the server is not running or reachable (Are you connected to the CU network?).")
    });
    //Else, tweet has been coded, so we remove the tweet and set it back to default
  }else if (val==1){
    $.post("http://localhost:4501/sqlite-remove",
    {
        tweet:  id,
        user:   user,
        detail: detail
    },
    function(data, status){
      if (status=="success"){
        //Set the data-val to 0
        $(that).attr("data-val","0"); //setter
        that.classList.remove("btn-success")
        that.classList.add("btn-light")
      }
    }).fail(function(xhr, status, error) {
      console.error(xhr, status, error)
      alert("Yikes! Somthing is wrong, likley the server is not running or reachable (are you connected to the CU network?).")
    });
  }
});

</script>

</body>
<html>
